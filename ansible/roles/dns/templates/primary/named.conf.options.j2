acl "trusted" {
{#
We don't use the variables `ansible_default_ipv4` and `ansible_facts` because
they are not always available for the hosts that are not in the current playbook
server group. See https://github.com/ansible/ansible/issues/30425.

When this template is used, we are processing the DNS primary server group, so
if the group `dns_clients` includes any hosts that are not part of the DNS
primary server group, their `hostvars` wouldn't include `ansible_default_ipv4`;
`ansible_facts` is included but is empty.

Need to use `ansible_host` and `inventory_hostname` as replacements.
#}
{% for h in groups["dns_clients"] %}
    {{hostvars[h]["ansible_host"]}} # {{hostvars[h]["inventory_hostname"]}}
{% endfor %}
};

options {
    directory "/var/cache/bind";

    recursion yes;                 # enables resursive queries
    allow-recursion { trusted; };  # allows recursive queries from "trusted" clients
    listen-on { {{hostvars[inventory_hostname]["ansible_host"]}}; };   #  listen on private network only
    allow-transfer { none; };      # disable zone transfers by default

    forwarders {
            8.8.8.8;
            8.8.4.4;
    };

    //========================================================================
    // If BIND logs error messages about the root key being expired,
    // you will need to update your keys.  See https://www.isc.org/bind-keys
    //========================================================================
    dnssec-validation auto;

    auth-nxdomain no;    # conform to RFC1035
    listen-on-v6 { any; };
};
