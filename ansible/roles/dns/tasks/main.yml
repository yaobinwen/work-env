- name: Update APT cache.
  apt:
    update_cache: yes
    cache_valid_time: 900

- name: Install BIND9.
  apt:
    name:
      - bind9
      - bind9utils
      - bind9-doc

- name: Set BIND to IPv4 mode.
  lineinfile:
    backup: no
    create: no
    regexp: "^OPTIONS=\"-u bind\"$"
    line: OPTIONS="-u bind -4"
    path: /etc/default/bind9

- name: Configure the primary DNS.
  when: server_role == "primary"
  include_tasks: dns-primary.yml

- name: Restart BIND.
  systemd:
    name: bind9
    state: restarted
